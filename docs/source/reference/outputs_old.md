# Output Files Reference

This page documents all output files generated by AlleleFlux.

\---

## Output Directory Structure

After running the workflow, the output directory contains:

```text
{root_dir}/
└── {data_type}/                          # "single_timepoint" or "longitudinal"
    ├── profiles/                         # Sample-level profiling results
    │   └── {sample}/
    │       └── {sample}_{mag}_profiled.tsv.gz
    ├── inputMetadata/                    # MAG-specific metadata
    │   └── inputMetadata_{timepoints}-{groups}/
    │       └── {mag}_metadata.tsv
    ├── QC/                               # Quality control results
    │   └── QC_{timepoints}-{groups}/
    │       └── {mag}_qc.tsv
    ├── eligibility_table_{timepoints}-{groups}.tsv
    ├── allele_analysis/                  # Allele frequency results
    │   └── allele_analysis_{timepoints}-{groups}/
    │       └── {mag}_allele_frequency_*.tsv.gz
    ├── significance_tests/               # Statistical test results
    │   ├── two_sample_unpaired_{timepoints}-{groups}/
    │   ├── two_sample_paired_{timepoints}-{groups}/
    │   ├── single_sample_{timepoints}-{groups}/
    │   ├── lmm_{timepoints}-{groups}/
    │   └── cmh_{timepoints}-{groups}/
    ├── scores/                           # Parallelism & divergence scores
    │   ├── intermediate/
    │   │   ├── MAG_scores_{timepoints}-{groups}/
    │   │   └── MAG_scores_cmh_{timepoints}-{groups}/
    │   └── processed/
    │       ├── combined/
    │       └── gene_scores_{timepoints}-{groups}/
    └── outlier_genes/                    # Outlier gene detection
        └── {timepoints}-{groups}/
```

\---

## Profile Files

**Location:** `profiles/{sample}/{sample}_{mag}_profiled.tsv.gz`

Base-level coverage and allele information for each sample-MAG pair.

**Columns:**

```{eval-rst}
.. list-table::
   :widths: 20 15 65
   :header-rows: 1

   * - Column
     - Type
     - Description
   * - ``contig``
     - string
     - Contig identifier
   * - ``position``
     - int
     - 0-based genomic position
   * - ``ref_base``
     - string
     - Reference base at this position (A, C, G, T, or N)
   * - ``total_coverage``
     - int
     - Total read coverage at this position
   * - ``A``
     - int
     - Count of adenine bases
   * - ``C``
     - int
     - Count of cytosine bases
   * - ``G``
     - int
     - Count of guanine bases
   * - ``T``
     - int
     - Count of thymine bases
   * - ``N``
     - int
     - Count of ambiguous bases
   * - ``mapq_scores``
     - string
     - Comma-separated MAPQ scores for reads at this position
   * - ``gene_id``
     - string
     - Gene identifier if position overlaps a gene (null otherwise)
```

\---

## Quality Control Files

**Location:** `QC/QC_{timepoints}-{groups}/{mag}_qc.tsv`

Sample-level QC metrics for each MAG.

**Columns:**

```{eval-rst}
.. list-table::
   :widths: 25 15 60
   :header-rows: 1

   * - Column
     - Type
     - Description
   * - ``sample_id``
     - string
     - Sample identifier
   * - ``mag_id``
     - string
     - MAG identifier
   * - ``breadth_of_coverage``
     - float
     - Fraction of genome with ≥1x coverage (0.0-1.0)
   * - ``mean_coverage``
     - float
     - Average coverage depth across covered positions
   * - ``median_coverage``
     - float
     - Median coverage depth
   * - ``passed_breadth``
     - bool
     - Whether sample passed breadth threshold
   * - ``passed_coverage``
     - bool
     - Whether sample passed coverage threshold
   * - ``group``
     - string
     - Experimental group
   * - ``replicate``
     - string
     - Replicate identifier
   * - ``time``
     - string
     - Timepoint (longitudinal only)
   * - ``subjectID``
     - string
     - Subject identifier
```

\---

## Eligibility Table

**Location:** `eligibility_table_{timepoints}-{groups}.tsv`

Determines which MAGs qualify for each statistical test.

**Columns:**

```{eval-rst}
.. list-table::
   :widths: 25 15 60
   :header-rows: 1

   * - Column
     - Type
     - Description
   * - ``mag_id``
     - string
     - MAG identifier
   * - ``eligible_two_sample_paired``
     - bool
     - Eligible for paired two-sample tests
   * - ``eligible_two_sample_unpaired``
     - bool
     - Eligible for unpaired two-sample tests
   * - ``eligible_single_sample``
     - bool
     - Eligible for single-sample tests
   * - ``eligible_lmm``
     - bool
     - Eligible for Linear Mixed Models
   * - ``eligible_cmh``
     - bool
     - Eligible for CMH tests
   * - ``samples_group1``
     - int
     - Number of valid samples in group 1
   * - ``samples_group2``
     - int
     - Number of valid samples in group 2
```

\---

## Allele Frequency Files

**Location:** `allele_analysis/allele_analysis_{timepoints}-{groups}/{mag}_allele_frequency_*.tsv.gz`

Processed allele frequency data.

**Key Columns:**

```{eval-rst}
.. list-table::
   :widths: 20 15 65
   :header-rows: 1

   * - Column
     - Type
     - Description
   * - ``MAG_ID``
     - string
     - MAG identifier
   * - ``contig``
     - string
     - Contig identifier
   * - ``position``
     - int
     - 0-based genomic position
   * - ``gene_id``
     - string
     - Gene identifier (if applicable)
   * - ``A_frequency``
     - float
     - Frequency of adenine (0.0-1.0)
   * - ``C_frequency``
     - float
     - Frequency of cytosine (0.0-1.0)
   * - ``G_frequency``
     - float
     - Frequency of guanine (0.0-1.0)
   * - ``T_frequency``
     - float
     - Frequency of thymine (0.0-1.0)
   * - ``sample_id``
     - string
     - Sample identifier
   * - ``group``
     - string
     - Experimental group
   * - ``time``
     - string
     - Timepoint (longitudinal only)
```

\---

## Statistical Test Results

### CMH Test Results

**Location:** `significance_tests/cmh_{timepoints}-{groups}/{mag}_cmh.tsv.gz`

**Columns:**

```{eval-rst}
.. list-table::
   :widths: 20 15 65
   :header-rows: 1

   * - Column
     - Type
     - Description
   * - ``mag_id``
     - string
     - MAG identifier
   * - ``contig``
     - string
     - Contig identifier
   * - ``gene_id``
     - string
     - Gene identifier
   * - ``position``
     - int
     - 0-based position
   * - ``num_pairs``
     - int
     - Number of replicate pairs tested
   * - ``p_value_CMH``
     - float
     - CMH test p-value
   * - ``time``
     - string
     - Timepoint (longitudinal only)
   * - ``notes``
     - string
     - Error messages or warnings
```

### Two-Sample Test Results

**Location:** `significance_tests/two_sample_{paired|unpaired}_{timepoints}-{groups}/{mag}_two_sample_{paired|unpaired}.tsv.gz`

**Columns:**

```{eval-rst}
.. list-table::
   :widths: 25 15 60
   :header-rows: 1

   * - Column
     - Type
     - Description
   * - ``contig``
     - string
     - Contig identifier
   * - ``position``
     - int
     - 0-based position
   * - ``gene_id``
     - string
     - Gene identifier
   * - ``p_value_{test_type}``
     - float
     - P-value from the statistical test
   * - ``q_value``
     - float
     - FDR-adjusted p-value
   * - ``effect_size``
     - float
     - Effect size (if applicable)
```

### LMM Test Results

**Location:** `significance_tests/lmm_{timepoints}-{groups}/{mag}_lmm.tsv.gz`

**Columns:**

```{eval-rst}
.. list-table::
   :widths: 20 15 65
   :header-rows: 1

   * - Column
     - Type
     - Description
   * - ``contig``
     - string
     - Contig identifier
   * - ``position``
     - int
     - 0-based position
   * - ``gene_id``
     - string
     - Gene identifier
   * - ``p_value_LMM``
     - float
     - LMM p-value
   * - ``coefficient``
     - float
     - Model coefficient
   * - ``std_error``
     - float
     - Standard error of coefficient
```

\---

## Score Files

### MAG-Level Scores

**Location:** `scores/intermediate/MAG_scores_{timepoints}-{groups}/{mag}_score_{test_type}.tsv`

**Columns:**

```{eval-rst}
.. list-table::
   :widths: 30 15 55
   :header-rows: 1

   * - Column
     - Type
     - Description
   * - ``MAG_ID``
     - string
     - MAG identifier
   * - ``total_sites_per_group_{test}``
     - int
     - Total sites tested
   * - ``significant_sites_per_group_{test}``
     - int
     - Sites with p-value < threshold
   * - ``score_{test} (%)``
     - float
     - Percentage of significant sites (parallelism/divergence score)
```

### Combined Scores

**Location:** `scores/processed/combined/scores_{test_type}-{timepoints}-{groups}-MAGs.tsv`

Aggregated scores for all MAGs.

**Location:** `scores/processed/combined/scores_{test_type}-{timepoints}-{groups}-{taxon}.tsv`

Scores aggregated by taxonomic rank (phylum, class, order, family, genus).

### Gene-Level Scores

**Location:** `scores/processed/gene_scores_{timepoints}-{groups}/{mag}_{test_type}_gene_scores_*.tsv`

**Files:**

- `*_gene_scores_combined.tsv`: Combined gene scores
- `*_gene_scores_individual.tsv`: Individual gene scores
- `*_gene_scores_overlapping.tsv`: Scores for overlapping genes

**Columns:**

```{eval-rst}
.. list-table::
   :widths: 30 15 55
   :header-rows: 1

   * - Column
     - Type
     - Description
   * - ``gene_id``
     - string
     - Gene identifier
   * - ``total_sites_per_group_{test}``
     - int
     - Total sites in this gene
   * - ``significant_sites_per_group_{test}``
     - int
     - Significant sites in this gene
   * - ``score_{test} (%)``
     - float
     - Gene-level score
```

\---

## Outlier Gene Files

**Location:** `outlier_genes/{timepoints}-{groups}/{mag}_{test_type}_outlier_genes.tsv`

Genes with exceptionally high scores (statistical outliers).

**Columns:**

```{eval-rst}
.. list-table::
   :widths: 30 15 55
   :header-rows: 1

   * - Column
     - Type
     - Description
   * - ``gene_id``
     - string
     - Gene identifier
   * - ``mag_score_{test} (%)``
     - float
     - MAG-level score for comparison
   * - ``gene_score_{test} (%)``
     - float
     - Gene-level score
   * - ``p_value_binomial_{test}``
     - float
     - Binomial test p-value
   * - ``p_value_poisson_{test}``
     - float
     - Poisson test p-value
   * - ``is_outlier``
     - bool
     - Whether gene is classified as outlier
```

\---

## Understanding Score Values

**Parallelism Score:**

- Range: 0-100%
- Meaning: Percentage of sites showing significant allele frequency changes in parallel across replicates
- High scores (>10%): Strong parallel evolution, suggesting deterministic selection
- Low scores (\<1%): Stochastic changes predominate

**Divergence Score:**

- Range: 0-100%
- Meaning: Percentage of sites showing significant differences between groups
- High scores: Strong differential selection between conditions
- Low scores: Similar allele frequencies between groups

**Interpretation Tips:**

1. Compare scores across MAGs to identify those under strongest selection
2. Use taxon-aggregated scores to find patterns at higher taxonomic levels
3. Examine outlier genes for candidates involved in adaptation

\---

## Visualization Outputs

The visualization workflow generates several output files. See {doc}`../usage/visualization_guide` for the complete workflow.

### Terminal Nucleotide Files

**Location:** `{output_dir}/{mag_id}/{mag_id}_terminal_nucleotides.tsv`

Results from terminal nucleotide analysis identifying endpoint alleles.

**Columns:**

```{eval-rst}
.. list-table::
   :widths: 30 15 55
   :header-rows: 1

   * - Column
     - Type
     - Description
   * - ``mag_id``
     - string
     - MAG identifier
   * - ``contig``
     - string
     - Contig identifier
   * - ``position``
     - int
     - 0-based genomic position
   * - ``gene_id``
     - string
     - Gene identifier
   * - ``terminal_nucleotide_mean_freq``
     - string
     - Terminal allele (mean frequency method)
   * - ``terminal_nucleotide_majority_vote``
     - string
     - Terminal allele (majority vote method)
   * - ``min_p_value``
     - float
     - Original minimum p-value
   * - ``q_value``
     - float
     - Original FDR-adjusted p-value
```

**Additional Files:**

- `{mag_id}_frequencies.tsv`: Full frequency data for all samples at each site
- `terminal_nucleotide_analysis_summary.tsv`: Summary statistics across all MAGs

### Allele Frequency Tables

**Location:** `{output_dir}/{mag_id}_frequency_table.*.tsv`

Frequency tables for tracking anchor alleles across samples.

**Wide Format** (`{mag_id}_frequency_table.wide.tsv`):

Sites as rows, samples as columns:

```{eval-rst}
.. list-table::
   :widths: 25 15 60
   :header-rows: 1

   * - Column
     - Type
     - Description
   * - ``contig``
     - string
     - Contig identifier
   * - ``position``
     - int
     - Genomic position
   * - ``gene_id``
     - string
     - Gene identifier
   * - ``anchor_allele``
     - string
     - The tracked allele (A, C, G, or T)
   * - ``anchor_criteria``
     - string
     - Method used to determine anchor
   * - ``{sample_id}``
     - float
     - Frequency of anchor allele in each sample (0-1)
   * - ``n_samples_non_nan``
     - int
     - Count of samples with data at this site
```

**Long Format** (`{mag_id}_frequency_table.long.tsv`):

Tidy format for R/ggplot2:

```{eval-rst}
.. list-table::
   :widths: 25 15 60
   :header-rows: 1

   * - Column
     - Type
     - Description
   * - ``contig``
     - string
     - Contig identifier
   * - ``position``
     - int
     - Genomic position
   * - ``gene_id``
     - string
     - Gene identifier
   * - ``anchor_allele``
     - string
     - The tracked allele
   * - ``sample_id``
     - string
     - Sample identifier
   * - ``frequency``
     - float
     - Anchor allele frequency (0-1)
   * - ``group``
     - string
     - Experimental group
   * - ``time``
     - string
     - Timepoint
   * - ``subjectID``
     - string
     - Subject/replicate identifier
```

### Visualization Plots

**Location:** `{output_dir}/` or `{output_dir}/per_site/`

**Combined Plots:**

```{eval-rst}
.. list-table::
   :widths: 40 60
   :header-rows: 1

   * - Filename Pattern
     - Description
   * - ``{mag_id}_line_plot.{format}``
     - Line trajectories for top N significant sites
   * - ``{mag_id}_box_plot.{format}``
     - Box plots of frequency distributions by timepoint
   * - ``{mag_id}_violin_plot.{format}``
     - Violin plots showing frequency density
```

**Per-Site Plots** (when `--per_site` enabled):

```{eval-rst}
.. list-table::
   :widths: 50 50
   :header-rows: 1

   * - Filename Pattern
     - Description
   * - ``per_site/{contig}_{position}_{gene}_line.{format}``
     - Individual site trajectory
   * - ``per_site/{contig}_{position}_{gene}_by_replicate.{format}``
     - Site trajectory grouped by replicate
```

**Supported Formats:** `png`, `pdf`, `svg`

\---

## dN/dS Analysis Outputs

**Location:** `dnds/{timepoints}-{groups}/{mag_id}/`

Evolutionary rate analysis output files.

**Key Files:**

```{eval-rst}
.. list-table::
   :widths: 40 60
   :header-rows: 1

   * - File
     - Description
   * - ``{mag_id}_codon_events.tsv``
     - Per-codon synonymous/nonsynonymous events
   * - ``{mag_id}_gene_summary.tsv``
     - Gene-level dN/dS statistics
   * - ``{mag_id}_mag_summary.tsv``
     - MAG-level aggregated dN/dS
   * - ``{mag_id}_ancestral_orfs.fasta``
     - Reconstructed ancestral ORF sequences
```

**Gene Summary Columns:**

```{eval-rst}
.. list-table::
   :widths: 25 15 60
   :header-rows: 1

   * - Column
     - Type
     - Description
   * - ``gene_id``
     - string
     - Gene identifier
   * - ``dn``
     - float
     - Rate of nonsynonymous substitutions
   * - ``ds``
     - float
     - Rate of synonymous substitutions
   * - ``dn_ds``
     - float
     - dN/dS ratio (omega)
   * - ``n_sites``
     - int
     - Number of significant sites in gene
   * - ``gene_length``
     - int
     - Gene length in base pairs
```
